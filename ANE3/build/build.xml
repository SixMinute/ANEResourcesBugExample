<project name='ANE-Device Controller' basedir='../' default='compile'>

	<!-- Load variables -->
	<property file='build/build.properties'/>

	<!-- Compile ANE -->
	<target name='compile'>
		<local name='build_dir' />
		<property name='build_dir' value='bin-debug'/>
		
		<local name='proj_name' />
		<property name='proj_name' value='ANE3Test' />
		
		<local name='output' />
		<property name='output' value='${proj_name}.apk' />
		
		<local name='appid' />
		<property name='appid' value='com.sixminute.${proj_name}.debug'/>
		
		<echo>
Mac
${os.name} ${os.arch} ${os.version}
Java
${java.runtime.version} - ${JAVA_HOME}
AIR
		</echo>
		<exec executable='${AIR_HOME}/bin/adt' failonerror='false'>
			<arg value='-version' />
		</exec>
		
		<echo>attempting uninstall of ${appid}</echo>
		<exec executable='${AIR_HOME}/bin/adt' failonerror='false' dir='${build_dir}'>
			<arg value='-uninstallApp' />
			<arg line='-platform android' />
			<arg line='-appid ${appid}' />
			<env key='JAVA_HOME' value='${JAVA_HOME}' />
		</exec>
		
		<echo>packaging ${output}
${AIR_HOME}/bin/adt \
	-package -target apk \
	-storetype pkcs12 -keystore '${KEYFILE}' -storepass ${KEYPASS} \
	${output} ${proj_name}-app.xml ${proj_name}.swf
	-extdir ../libs/
		</echo>
		<exec executable='${AIR_HOME}/bin/adt' failonerror='true' dir='${build_dir}'>
			<arg value='-package' />
			<arg line='-target apk' />
			
			<arg line='-storetype pkcs12' />
			<arg line='-keystore "${KEYFILE}"' />
			<arg line='-storepass ${KEYPASS}' />
			
			<arg line='${output} ${proj_name}-app.xml ${proj_name}.swf' />
			
			<arg line='-extdir ../libs/' />
			<env key='JAVA_HOME' value='${JAVA_HOME}' />
		</exec>
		
		<echo>installing ${output}</echo>
		<exec executable='${AIR_HOME}/bin/adt' failonerror='true' dir='${build_dir}'>
			<arg value='-installApp' />
			<arg line='-platform android' />
			<arg line='-package ${output}' />
			<env key='JAVA_HOME' value='${JAVA_HOME}' />
		</exec>
		
		<echo>launching ${appid}</echo>
		<exec executable='${AIR_HOME}/bin/adt' failonerror='true' dir='${build_dir}'>
			<arg value='-launchApp' />
			<arg line='-platform android' />
			<arg line='-appid ${appid}' />
			<env key='JAVA_HOME' value='${JAVA_HOME}' />
		</exec>
	</target>
</project>
